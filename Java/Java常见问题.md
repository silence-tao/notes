# Java常见问题

## 1.频繁FullGC

### 1.1 可能发生的原因及解决方案

#### 1.1.1 全局的集合类

**原因分析：**

有全局的集合类，在系统运行过程中，一直在往对象里面添加数据，而没有删除数据，因为是全局类变量，垃圾回收器就没法回收里面保存的对象，就会导致频繁FullGC，最终可能还会发生内存溢出。

**解决方案：**

采用带有内存淘汰算法（LRU、LFU等）的缓存工具类代替集合类，比如Guava里面的GuavaCache，设置GuavaCache的大小以及对象的最大存活时间，就可以避免对象无法被回收导致频繁FullGC的问题了。

#### 1.1.2 内存泄漏

**原因分析：**

当应用在使用特定的客户端连接外部资源（MySQL、Redis、OSS等）时，如果没有正确的释放客户端所创建的资源，那么当客户端与外部资源断开连接，因为客户端创建的资源还有依赖，导致客户端和它创建的资源都没法被回收，慢慢的堆内存占用就会越来越大，进而导致频繁FullGC，最终可能还会发生内存溢出。

**解决方案：**

任何客户端创建的资源，都要在用完了之后立马释放掉。

#### 1.1.3 大对象

**原因分析：**

如果一次SQL查询语句返回的数据过多，就会产生大对象问题，进而导致频繁FullGC。

**解决方案：**

优化SQL语句，避免一次查询返回的数据过多。

#### 1.1.4 死循环

**原因分析：**

因为代码中有死循环，导致频繁创建大量的对象，进而导致频繁FullGC。

**解决方案：**

通过分析火焰图，找到顶部宽度最大的函数，大概率就是出现死循环的地方，优化掉死循环的代码即可。

## 1.2 排查思路

使用MAT等工具分析Java堆的dump日志，找到占用大量堆内存的对象，进一步定位到出问题的代码。

**案例参考：**

[全局的集合类](https://dongzl.github.io/2019/09/20/05-online-system-frequent-full-gc-bug/index.html)

[内存泄漏问题](https://blog.csdn.net/u012422829/article/details/78154495)

[大对象问题](https://www.jianshu.com/p/1c6bc8842463)

[大对象问题](https://cloud.tencent.com/developer/article/1824276)

